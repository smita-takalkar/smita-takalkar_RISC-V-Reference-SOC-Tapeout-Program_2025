# 🧩 Week 3 – Post-Synthesis Gate-Level Simulation (GLS) of BabySoC

> **Reference:** [GLS Flow and Methodology](https://github.com/Ananya-KM/VSD_HDP/blob/main/Day%206.md)  
> **Objective:** Perform Gate-Level Simulation (GLS) on the synthesized BabySoC to verify post-synthesis functionality and timing accuracy.

## 🎯 Notes – Purpose of GLS

Gate-Level Simulation (GLS) is done **after synthesis** to make sure the design still works as expected once it’s converted into gates.  
At this stage, we are no longer working with RTL (behavioral) code — instead, we simulate the **gate-level netlist** generated by synthesis.

---

### 🔍 Key Points to Remember

1. **⏱️ Timing Verification**
   - GLS uses **SDF (Standard Delay Format)** files which include real timing delays.
   - Helps check whether the design works correctly under **actual timing conditions**, not just logically.

2. **🧩 Logic Validation After Synthesis**
   - Even after synthesis, the design’s **functionality must remain the same**.
   - GLS helps catch timing-related issues like **glitches, race conditions, or metastability** that might not appear in RTL simulation.

3. **🧰 Simulation Tools Used**
   - **Icarus Verilog (iverilog)** → for compiling and running the gate-level simulation.
   - **GTKWave** → for viewing and analyzing the waveform results (`.vcd` file).

4. **🤖 Why GLS is Important for BabySoC**
   - BabySoC has multiple modules — **RISC-V Core, PLL, DAC**, etc.
   - GLS ensures that:
     - These modules **interact correctly** after synthesis.
     - The **timing and signal integrity** are maintained.
     - The final SoC works reliably in real hardware conditions.

---
📌 GLS is like a final functional check after synthesis — it validates both **logic** and **timing** using real gate-level information.

## ⚙️ Step-by-Step Execution Flow

### 🧠 Step 1: Load the Top-Level Design and Supporting Modules

```bash
cd vsdtapeout/VSDBabySoc
yosys
````

Inside Yosys shell:

```bash
read_verilog ./src/module/vsdbabysoc.v
read_verilog -I ./src/include ./src/module/rvmyth.v
read_verilog -I ./src/include ./src/module/clk_gate.v
```

---

### 📘 Step 2: Load the Liberty Files for Synthesis

```bash
read_liberty -lib ./src/lib/avsdpll.lib
read_liberty -lib ./src/lib/avsddac.lib
read_liberty -lib ./src/lib/sky130_fd_sc_hd__tt_025C_1v80.lib
```

---

### 🏗️ Step 3: Run Synthesis Targeting `vsdbabysoc`

```bash
synth -top vsdbabysoc
```

---

### 🧬 Step 4: Map D Flip-Flops to Standard Cells

```bash
dfflibmap -liberty ./src/lib/sky130_fd_sc_hd__tt_025C_1v80.lib
```

---

### 🛠️ Step 5: Perform Optimization and Technology Mapping

```bash
opt
abc -liberty ./src/lib/sky130_fd_sc_hd__tt_025C_1v80.lib -script +strash;scorr;ifraig;retime;{D};strash;dch,-f;map,-M,1,{D}
```

---

### 🧹 Step 6: Final Clean-Up and Renaming

```bash
flatten
setundef -zero
clean -purge
rename -enumerate
```

---

### 📊 Step 7: Check Synthesis Statistics

```bash
stat
```

View the number of cells, gates, and nets to ensure synthesis success.

---

### 💾 Step 8: Write the Synthesized Netlist

```bash
write_verilog -noattr ./output/post_synth_sim/vsdbabysoc.synth.v
```

This file is your **post-synthesis gate-level netlist** ready for simulation.

---

## 🧪 Post-Synthesis Simulation and Waveform Generation

### 🔧 Step 1: Compile the Testbench

```bash
iverilog -o ./output/post_synth_sim/post_synth_sim.out \
  -DPOST_SYNTH_SIM -DFUNCTIONAL -DUNIT_DELAY=#1 \
  -I ./src/include \
  -I ./src/module \
  -I ./src/gls_model \
  ./src/module/testbench.v
```

#### Explanation:

| Option               | Description                                  |
| :------------------- | :------------------------------------------- |
| `-I ./src/include`   | Includes header and macro files              |
| `-I ./src/module`    | Includes Verilog modules                     |
| `-I ./src/gls_model` | Includes `primitives.v` for gate definitions |

---

### 📁 Step 2: Navigate to Simulation Output Directory

```bash
cd output/post_synth_sim/
```

---

### ▶️ Step 3: Run the Simulation

```bash
./post_synth_sim.out
```

Generates `post_synth_sim.vcd` waveform file.

---

### 📈 Step 4: View Waveforms in GTKWave

```bash
gtkwave post_synth_sim.vcd
```



---

## 🧾 Summary

| Step | Task                      | Tool           |
| :--- | :------------------------ | :------------- |
| 1    | Load design and libraries | Yosys          |
| 2    | Synthesize and optimize   | Yosys          |
| 3    | Generate netlist          | Yosys          |
| 4    | Compile and simulate      | Icarus Verilog |
| 5    | View results              | GTKWave        |

---




