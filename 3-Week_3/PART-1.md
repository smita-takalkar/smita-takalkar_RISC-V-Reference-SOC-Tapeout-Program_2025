# 🧩 Week 3 | PART 1 – Post-Synthesis Gate-Level Simulation (GLS) of BabySoC

> **Reference:** [GLS Flow and Methodology](https://github.com/Ananya-KM/VSD_HDP/blob/main/Day%206.md)  
> **Objective:** Perform Gate-Level Simulation (GLS) on the synthesized BabySoC to verify post-synthesis functionality and timing accuracy.

## 🎯 Notes – Purpose of GLS

Gate-Level Simulation (GLS) is done **after synthesis** to make sure the design still works as expected once it’s converted into gates.  
At this stage, we are no longer working with RTL (behavioral) code — instead, we simulate the **gate-level netlist** generated by synthesis.

---

### 🔍 Key Points to Remember

1. **⏱️ Timing Verification**
   - GLS uses **SDF (Standard Delay Format)** files which include real timing delays.
   - Helps check whether the design works correctly under **actual timing conditions**, not just logically.

2. **🧩 Logic Validation After Synthesis**
   - Even after synthesis, the design’s **functionality must remain the same**.
   - GLS helps catch timing-related issues like **glitches, race conditions, or metastability** that might not appear in RTL simulation.

3. **🧰 Simulation Tools Used**
   - **Icarus Verilog (iverilog)** → for compiling and running the gate-level simulation.
   - **GTKWave** → for viewing and analyzing the waveform results (`.vcd` file).

4. **🤖 Why GLS is Important for BabySoC**
   - BabySoC has multiple modules — **RISC-V Core, PLL, DAC**, etc.
   - GLS ensures that:
     - These modules **interact correctly** after synthesis.
     - The **timing and signal integrity** are maintained.
     - The final SoC works reliably in real hardware conditions.

---
📌 GLS is like a final functional check after synthesis — it validates both **logic** and **timing** using real gate-level information.

## ⚙️ Step-by-Step Execution Flow

### 🧠 Step 1: Load the Top-Level Design and Supporting Modules

```bash
cd vsdtapeout/VSDBabySoc
yosys
````

Inside Yosys shell:

```bash
read_verilog ./src/module/vsdbabysoc.v
read_verilog -I ./src/include ./src/module/rvmyth.v
read_verilog -I ./src/include ./src/module/clk_gate.v
```
<img width="866" height="629" alt="Synthesis_logs1" src="https://github.com/user-attachments/assets/7e6fc03e-116d-4beb-83bf-adf357887735" />


---

### 📘 Step 2: Load the Liberty Files for Synthesis

```bash
read_liberty -lib ./src/lib/avsdpll.lib
read_liberty -lib ./src/lib/avsddac.lib
read_liberty -lib ./src/lib/sky130_fd_sc_hd__tt_025C_1v80.lib
```
<img width="866" height="629" alt="Synthesis_logs2" src="https://github.com/user-attachments/assets/b535a491-7660-47f2-9aed-27d675965bff" />


---

### 🏗️ Step 3: Run Synthesis Targeting `vsdbabysoc`

```bash
synth -top vsdbabysoc
```
<img width="1534" height="868" alt="Synthesis_logs3" src="https://github.com/user-attachments/assets/6bfbcfc6-ca25-4d9b-9333-f28390ed7302" /> 

<img width="1534" height="868" alt="Synthesis_logs4" src="https://github.com/user-attachments/assets/88ab29f6-42cf-48ae-9648-ed890a46f372" />

<img width="1534" height="868" alt="Synthesis_logs5" src="https://github.com/user-attachments/assets/785272be-1295-456f-b057-bd9330be8a48" />



---

### 🧬 Step 4: Map D Flip-Flops to Standard Cells

```bash
dfflibmap -liberty ./src/lib/sky130_fd_sc_hd__tt_025C_1v80.lib
```
<img width="1534" height="868" alt="Synthesis_logs6" src="https://github.com/user-attachments/assets/fdc9c184-0207-4b8d-8739-a576c9e62af3" />


---

### 🛠️ Step 5: Perform Optimization and Technology Mapping

```bash
opt
abc -liberty ./src/lib/sky130_fd_sc_hd__tt_025C_1v80.lib -script +strash;scorr;ifraig;retime;{D};strash;dch,-f;map,-M,1,{D}
```
<img width="866" height="629" alt="Synthesis_logs7" src="https://github.com/user-attachments/assets/455b0a57-e40f-405e-8619-25abe1adee52" />


---

### 🧹 Step 6: Final Clean-Up and Renaming

```bash
flatten
setundef -zero
clean -purge
rename -enumerate
```
<img width="866" height="629" alt="Synthesis_logs8" src="https://github.com/user-attachments/assets/1c555a33-f46c-464d-bb9b-855d45c540fc" />


---

### 📊 Step 7: Check Synthesis Statistics

```bash
stat
```
<img width="1534" height="868" alt="Synthesis_logs9" src="https://github.com/user-attachments/assets/37772936-80c3-4da4-b691-3a3eded06a5f" />

<img width="1534" height="868" alt="Synthesis_logs10" src="https://github.com/user-attachments/assets/24d6633c-280b-4a6c-9f89-8f9a19998715" />

Shows the number of cells, gates, and nets to ensure synthesis success.

---

### 💾 Step 8: Write the Synthesized Netlist

```bash
write_verilog -noattr ./output/post_synth_sim/vsdbabysoc.synth.v
```
<img width="866" height="629" alt="Synthesis_logs11" src="https://github.com/user-attachments/assets/194caa0e-9ec4-4c68-aa69-beea12086663" />

This file is the **post-synthesis gate-level netlist** ready for simulation.

---

## 🧪 Post-Synthesis Simulation and Waveform Generation

### 🔧 Step 1: Compile the Testbench

```bash
iverilog -o ./output/post_synth_sim/post_synth_sim.out \
  -DPOST_SYNTH_SIM -DFUNCTIONAL -DUNIT_DELAY=#1 \
  -I ./src/include \
  -I ./src/module \
  -I ./src/gls_model \
  ./src/module/testbench.v
```

#### Explanation:

| Option               | Description                                  |
| :------------------- | :------------------------------------------- |
| `-I ./src/include`   | Includes header and macro files              |
| `-I ./src/module`    | Includes Verilog modules                     |
| `-I ./src/gls_model` | Includes `primitives.v` for gate definitions |

---
<img width="866" height="670" alt="Synthesis_logs12" src="https://github.com/user-attachments/assets/cf1a7938-adc4-411b-a52e-9933f3eed2cc" />


### 📁 Step 2: Navigate to Simulation Output Directory

```bash
cd output/post_synth_sim/
```

---

### ▶️ Step 3: Run the Simulation

```bash
./post_synth_sim.out
```

Generates `post_synth_sim.vcd` waveform file.

---

### 📈 Step 4: View Waveforms in GTKWave

```bash
gtkwave post_synth_sim.vcd
```
<img width="1600" height="900" alt="Synthesis_logs13" src="https://github.com/user-attachments/assets/3489d577-3768-4b9a-8ac4-35bfe05c4e15" />
<img width="1600" height="900" alt="Synthesis_logs14" src="https://github.com/user-attachments/assets/801bc617-6e20-4931-9778-89fa82e0bdac" />

#### Functional simulation output (Week 2 task):
<img width="1600" height="900" alt="post_synth_sim" src="https://github.com/user-attachments/assets/03e98ceb-245d-44af-a2e9-6e1ad1ca7ccc" />

### The waveforms obtained from GLS matched exactly with those from the functional simulation, confirming that the synthesized netlist preserves the original RTL functionality.

This indicates that:

* The synthesis process did not introduce any logical errors.
* The design functionality remains consistent before and after synthesis.
* The simulation environment (testbench and stimulus) was correctly applied in both cases.

✅ Conclusion:
The matching waveforms validate the correctness of synthesis and ensure that the post-synthesis design behaves as intended, confirming successful functional equivalence between RTL and GLS outputs.

---

## 🧾 Summary

| Step | Task                      | Tool           |
| :--- | :------------------------ | :------------- |
| 1    | Load design and libraries | Yosys          |
| 2    | Synthesize and optimize   | Yosys          |
| 3    | Generate netlist          | Yosys          |
| 4    | Compile and simulate      | Icarus Verilog |
| 5    | View results              | GTKWave        |

---




